name: ğŸ”¥ Firebase App Distribution

on:
  push:
    branches: [ main, develop ]
  workflow_dispatch:
    inputs:
      release_notes:
        description: 'ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ (ì„ íƒì‚¬í•­)'
        required: false
        default: 'ìƒˆë¡œìš´ ë¹Œë“œ ë°°í¬'

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
    
    - name: â˜• JDK 17 ì„¤ì •
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: ğŸ” Java ë²„ì „ í™•ì¸
      run: |
        echo "í˜„ì¬ Java ë²„ì „:"
        java -version
        echo "JAVA_HOME: $JAVA_HOME"
        echo "PATHì—ì„œ Java ê²½ë¡œ:"
        which java
        
    - name: ğŸ—‚ï¸ Gradle ìºì‹œ (Java 17ìš©)
      uses: actions/cache@v4
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
        key: ${{ runner.os }}-gradle-java17-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
        restore-keys: |
          ${{ runner.os }}-gradle-java17-
          
    - name: ğŸ”§ Gradlew ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
      run: chmod +x gradlew
      
    - name: ğŸ§¹ Gradle Clean (í•„ìš”ì‹œ)
      run: ./gradlew clean
      
    - name: ğŸ—ï¸ Debug APK ë¹Œë“œ
      run: ./gradlew assembleDebug
      
    - name: ğŸ“Š APK ì •ë³´ ì¶œë ¥
      run: |
        echo "ğŸ“± ìƒì„±ëœ APK ì •ë³´:"
        ls -la app/build/outputs/apk/debug/
        du -h app/build/outputs/apk/debug/app-debug.apk
      
    - name: ğŸš€ Firebase App Distribution ë°°í¬
      uses: wzieba/Firebase-Distribution-Github-Action@v1.7.0
      with:
        appId: ${{ secrets.FIREBASE_APP_ID }}
        serviceCredentialsFileContent: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_KEY }}
        groups: testers
        file: app/build/outputs/apk/debug/app-debug.apk
        releaseNotes: |
          ğŸš€ Adaptive Calibration ìƒˆ ë²„ì „ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!
          
          ğŸ“‹ ë¹Œë“œ ì •ë³´:
          â€¢ ì»¤ë°‹: ${{ github.sha }}
          â€¢ ë¸Œëœì¹˜: ${{ github.ref_name }}
          â€¢ ì•¡í„°: ${{ github.actor }}
          â€¢ ë¹Œë“œ ì‹œê°„: ${{ github.event.head_commit.timestamp }}
          
          ${{ github.event.inputs.release_notes || 'ğŸ”§ ìµœì‹  ê°œë°œ ë²„ì „' }}
          
          ğŸ“± ì„¤ì¹˜ ë°©ë²•:
          1. Firebase App Distribution ì•±ì—ì„œ ë‹¤ìš´ë¡œë“œ
          2. ë˜ëŠ” ì´ë©”ì¼ ë§í¬ë¥¼ í†µí•´ ì§ì ‘ ì„¤ì¹˜
          
          ğŸ› ë²„ê·¸ ë¦¬í¬íŠ¸: https://github.com/${{ github.repository }}/issues
          
    - name: âœ… ë°°í¬ ì™„ë£Œ ì•Œë¦¼
      if: success()
      run: |
        echo "ğŸ‰ Firebase App Distribution ë°°í¬ ì„±ê³µ!"
        echo "ğŸ“§ í…ŒìŠ¤í„°ë“¤ì—ê²Œ ì•Œë¦¼ì´ ì „ì†¡ë©ë‹ˆë‹¤."
        
    - name: âŒ ë°°í¬ ì‹¤íŒ¨ ì•Œë¦¼
      if: failure()
      run: |
        echo "ğŸ’¥ Firebase App Distribution ë°°í¬ ì‹¤íŒ¨!"
        echo "ğŸ” ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”."
